# Render PostgreSQL æ•°æ®åº“åˆ›å»ºè¯¦ç»†æ•™ç¨‹

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

ç¡®ä¿ä½ å·²ç»ï¼š
- âœ… æ³¨å†Œäº† Render è´¦å·
- âœ… éƒ¨ç½²äº† Django åç«¯åˆ° Render
- âœ… åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ

---

## ç¬¬ä¸€æ­¥ï¼šåˆ›å»º PostgreSQL æ•°æ®åº“

### 1.1 è¿›å…¥æ•°æ®åº“åˆ›å»ºé¡µé¢

1. ç™»å½• [Render.com](https://render.com)

2. åœ¨é¡¶éƒ¨å¯¼èˆªæ ï¼Œç‚¹å‡» **New +** æŒ‰é’®

3. åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© **Database**

### 1.2 é€‰æ‹©æ•°æ®åº“ç±»å‹

1. é€‰æ‹© **PostgreSQL**ï¼ˆé»˜è®¤é€‰ä¸­ï¼‰

2. ç‚¹å‡»é¡µé¢å³ä¾§çš„ **New PostgreSQL Database** æŒ‰é’®

### 1.3 é…ç½®æ•°æ®åº“å‚æ•°

å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

| é…ç½®é¡¹ | å¡«å†™å†…å®¹ | è¯´æ˜ |
|--------|---------|------|
| **Name** | `web-b2b-db` | æ•°æ®åº“æœåŠ¡çš„åç§°ï¼ˆå¯ä»¥è‡ªå®šä¹‰ï¼‰ |
| **Database** | `web_b2b` | æ•°æ®åº“åç§° |
| **User** | `web_b2b_user` | æ•°æ®åº“ç”¨æˆ·å |
| **Region** | `Oregon (US West)` | é€‰æ‹©ä¸åç«¯ç›¸åŒçš„åŒºåŸŸ |
| **PostgreSQL Version** | `16`ï¼ˆé»˜è®¤ï¼‰ | ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ |
| **Plan** | `Free`ï¼ˆé»˜è®¤ï¼‰ | å…è´¹å¥—é¤ |

**é‡è¦æç¤ºï¼š**
- **Region å¿…é¡»ä¸åç«¯ç›¸åŒ**ï¼Œå¦åˆ™ä¼šå¢åŠ å»¶è¿Ÿ
- Nameã€Databaseã€User å¯ä»¥è‡ªå®šä¹‰ï¼Œå»ºè®®ä½¿ç”¨ä¾¿äºè®°å¿†çš„åç§°
- å…è´¹å¥—é¤æœ‰ 90 å¤©è¯•ç”¨æœŸ

### 1.4 åˆ›å»ºæ•°æ®åº“

1. æ£€æŸ¥æ‰€æœ‰é…ç½®æ˜¯å¦æ­£ç¡®

2. ç‚¹å‡»é¡µé¢åº•éƒ¨çš„ **Create Database** æŒ‰é’®

3. ç­‰å¾…æ•°æ®åº“åˆ›å»ºå®Œæˆï¼ˆé€šå¸¸ 2-5 åˆ†é’Ÿï¼‰

**çŠ¶æ€è¯´æ˜ï¼š**
- çŠ¶æ€ä¼šä» `Create in progress` å˜ä¸º `Available` è¡¨ç¤ºåˆ›å»ºæˆåŠŸ
- åˆ›å»ºè¿‡ç¨‹ä¸­ä¸è¦å…³é—­æµè§ˆå™¨

---

## ç¬¬äºŒæ­¥ï¼šè·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯

### 2.1 è¿›å…¥æ•°æ®åº“è¯¦æƒ…é¡µé¢

1. åˆ›å»ºæˆåŠŸåï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°æ•°æ®åº“è¯¦æƒ…é¡µ

2. å¦‚æœæ²¡æœ‰è‡ªåŠ¨è·³è½¬ï¼Œç‚¹å‡» Dashboard ä¸­çš„ `web-b2b-db` æ•°æ®åº“

### 2.2 æ‰¾åˆ°è¿æ¥ä¿¡æ¯

å‘ä¸‹æ»šåŠ¨åˆ° **Connections** éƒ¨åˆ†ï¼Œä½ ä¼šçœ‹åˆ°ï¼š

1. **Internal Database URL**ï¼ˆå†…éƒ¨è¿æ¥ URLï¼‰
   - æ ¼å¼ï¼š`postgresql://web_b2b_user:password@dpg-xxx.oregon-postgres.render.com:5432/web_b2b`
   - è¿™æ˜¯ **Render å†…éƒ¨æœåŠ¡ä¹‹é—´** è¿æ¥ä½¿ç”¨çš„ URL
   - âš ï¸ **è¿™æ˜¯ä½ è¦å¤åˆ¶çš„ï¼**

2. **External Database URL**ï¼ˆå¤–éƒ¨è¿æ¥ URLï¼‰
   - æ ¼å¼ï¼š`postgresql://web_b2b_user:password@dpg-xxx.oregon-postgres.render.com:5432/web_b2b`
   - è¿™æ˜¯ä»æœ¬åœ°æˆ–å…¶ä»–å¤–éƒ¨æœåŠ¡è¿æ¥ä½¿ç”¨çš„ URL
   - æš‚æ—¶ä¸éœ€è¦

3. **PGBouncer Connection URL**
   - ä½¿ç”¨è¿æ¥æ± çš„ URL
   - ä¸éœ€è¦ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ Internal Database URL

### 2.3 å¤åˆ¶ Internal Database URL

1. æ‰¾åˆ° **Internal Database URL**

2. ç‚¹å‡»å³ä¾§çš„å¤åˆ¶æŒ‰é’®ï¼ˆğŸ“‹ï¼‰

3. **ä¿å­˜åˆ°è®°äº‹æœ¬**ï¼Œæ ¼å¼ç±»ä¼¼ï¼š
   ```
   postgresql://web_b2b_user:AbCdEf12345@dpg-abc123.oregon-postgres.render.com:5432/web_b2b
   ```

**URL ç»“æ„è¯´æ˜ï¼š**
```
postgresql://ç”¨æˆ·å:å¯†ç @ä¸»æœº:ç«¯å£/æ•°æ®åº“å
```

---

## ç¬¬ä¸‰æ­¥ï¼šé…ç½®åç«¯è¿æ¥æ•°æ®åº“

### 3.1 å›åˆ° Django åç«¯æœåŠ¡

1. ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ **Dashboard**

2. æ‰¾åˆ°ä½ çš„ Django åç«¯æœåŠ¡ï¼ˆä¾‹å¦‚ `django-backend` æˆ– `web-b2b`ï¼‰

3. ç‚¹å‡»è¿›å…¥æœåŠ¡è¯¦æƒ…é¡µ

### 3.2 æ·»åŠ ç¯å¢ƒå˜é‡

1. åœ¨æœåŠ¡è¯¦æƒ…é¡µï¼Œæ‰¾åˆ° **Environment** éƒ¨åˆ†

2. ç‚¹å‡» **Environment Variables** é“¾æ¥

3. ç‚¹å‡»å³ä¸Šè§’çš„ **+ Add Environment Variable** æŒ‰é’®

4. æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| Key | Value | è¯´æ˜ |
|-----|-------|------|
| `DATABASE_URL` | `ä½ å¤åˆ¶çš„ Internal Database URL` | æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² |

**ç¤ºä¾‹ï¼š**
```
Key: DATABASE_URL
Value: postgresql://web_b2b_user:AbCdEf12345@dpg-abc123.oregon-postgres.render.com:5432/web_b2b
```

### 3.3 ä¿å­˜ç¯å¢ƒå˜é‡

1. ç‚¹å‡»é¡µé¢åº•éƒ¨çš„ **Save Changes** æŒ‰é’®

2. **é‡è¦ï¼š** ä¿å­˜åï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²

3. ç­‰å¾…é‡æ–°éƒ¨ç½²å®Œæˆï¼ˆ2-3 åˆ†é’Ÿï¼‰

---

## ç¬¬å››æ­¥ï¼šè¿è¡Œæ•°æ®åº“è¿ç§»

### 4.1 ç­‰å¾…éƒ¨ç½²å®Œæˆ

1. åœ¨æœåŠ¡è¯¦æƒ…é¡µï¼ŒæŸ¥çœ‹ **Deploys** éƒ¨åˆ†

2. ç­‰å¾…æœ€æ–°éƒ¨ç½²çš„çŠ¶æ€å˜ä¸º `Live`ï¼ˆç»¿è‰²å‹¾é€‰ï¼‰

3. ç‚¹å‡»æœ€æ–°çš„éƒ¨ç½²æŸ¥çœ‹æ—¥å¿—

### 4.2 æ£€æŸ¥éƒ¨ç½²æ—¥å¿—

åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾ï¼š

**æˆåŠŸæ ‡å¿—ï¼š**
```
Applying contenttypes.0001_initial... OK
Applying auth.0001_initial... OK
...
Applying myapp.0001_initial... OK
```

**é”™è¯¯æ ‡å¿—ï¼š**
```
django.db.utils.OperationalError: could not connect to server
```

å¦‚æœçœ‹åˆ°è¿ç§»æˆåŠŸï¼Œè¯´æ˜æ•°æ®åº“è¿æ¥æ­£å¸¸ï¼

### 4.3 æ‰‹åŠ¨è¿è¡Œè¿ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœè‡ªåŠ¨éƒ¨ç½²æ—¶è¿ç§»å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨è¿è¡Œï¼š

**æ–¹æ³• 1ï¼šé€šè¿‡ Render Shellï¼ˆæ¨èï¼‰**

1. åœ¨æœåŠ¡è¯¦æƒ…é¡µï¼Œç‚¹å‡» **Shell** æŒ‰é’®

2. åœ¨ Shell ä¸­è¿è¡Œï¼š
   ```bash
   cd server
   python manage.py migrate
   ```

3. ç­‰å¾…è¿ç§»å®Œæˆ

4. è¾“å…¥ `exit` é€€å‡º Shell

**æ–¹æ³• 2ï¼šä¿®æ”¹ Build Commandï¼ˆä¸æ¨èï¼‰**

1. å›åˆ°æœåŠ¡è¯¦æƒ…é¡µ
2. ç‚¹å‡» **Settings**
3. æ‰¾åˆ° **Build & Deploy**
4. ä¿®æ”¹ **Build Command** ä¸ºï¼š
   ```
   pip install -r server/requirements.txt && cd server && python manage.py migrate
   ```
5. ç‚¹å‡» **Save Changes**

---

## ç¬¬äº”æ­¥ï¼šåˆ›å»ºè¶…çº§ç®¡ç†å‘˜

### 5.1 è¿›å…¥ Shell

1. åœ¨æœåŠ¡è¯¦æƒ…é¡µï¼Œç‚¹å‡» **Shell** æŒ‰é’®

2. ç­‰å¾… Shell è¿æ¥æˆåŠŸ

### 5.2 è¿è¡Œåˆ›å»ºç®¡ç†å‘˜å‘½ä»¤

åœ¨ Shell ä¸­è¿è¡Œï¼š

```bash
cd server
python manage.py createsuperuser
```

### 5.3 è¾“å…¥ç®¡ç†å‘˜ä¿¡æ¯

æŒ‰æç¤ºè¾“å…¥ï¼š

```
Username: admin
Email address: admin@example.com
Password: (è¾“å…¥å¯†ç ï¼Œä¾‹å¦‚ admin123)
Password (again): (å†æ¬¡è¾“å…¥å¯†ç )
Superuser created successfully.
```

**å¯†ç è¦æ±‚ï¼š**
- è‡³å°‘ 8 ä¸ªå­—ç¬¦
- ä¸èƒ½ä¸ç”¨æˆ·åå¤ªç›¸ä¼¼
- ä¸èƒ½å…¨æ˜¯æ•°å­—

### 5.4 é€€å‡º Shell

è¾“å…¥ `exit` æˆ–ç›´æ¥å…³é—­ Shell çª—å£

---

## ç¬¬å…­æ­¥ï¼šæµ‹è¯•æ•°æ®åº“è¿æ¥

### 6.1 è®¿é—®åå°ç®¡ç†

1. å¤åˆ¶åç«¯æœåŠ¡çš„ URLï¼ˆä¾‹å¦‚ï¼š`https://django-backend-xxxxx.onrender.com`ï¼‰

2. åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
   ```
   https://django-backend-xxxxx.onrender.com/admin/
   ```

3. ä½¿ç”¨ä½ åˆšåˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•

### 6.2 éªŒè¯åŠŸèƒ½

ç™»å½•åä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š

1. **Django åå°é¦–é¡µ**

2. **ç®¡ç†æ¨¡å—åˆ—è¡¨ï¼š**
   - Users å’Œ Groupsï¼ˆDjango è‡ªå¸¦ï¼‰
   - ä½ çš„åº”ç”¨æ¨¡å‹ï¼ˆä¾‹å¦‚ myapp ä¸‹çš„æ¨¡å—ï¼‰

3. **æµ‹è¯•æ“ä½œï¼š**
   - ç‚¹å‡»ä»»æ„æ¨¡å‹
   - æ·»åŠ ä¸€æ¡æµ‹è¯•æ•°æ®
   - ä¿å­˜å¹¶éªŒè¯æ˜¯å¦æˆåŠŸ

### 6.3 æŸ¥çœ‹æ•°æ®åº“è®°å½•ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æƒ³ç¡®è®¤æ•°æ®æ˜¯å¦çœŸçš„ä¿å­˜åˆ°æ•°æ®åº“ï¼š

1. å›åˆ°æ•°æ®åº“è¯¦æƒ…é¡µ

2. ç‚¹å‡» **Connect** æŒ‰é’®

3. é€‰æ‹© **External** è¿æ¥æ–¹å¼

4. ä½¿ç”¨ PostgreSQL å®¢æˆ·ç«¯è¿æ¥ï¼ˆéœ€è¦æœ¬åœ°å®‰è£… PostgreSQLï¼‰

**æˆ–è€…ä½¿ç”¨ Render çš„æ•°æ®åº“ç®¡ç†ç•Œé¢ï¼š**

1. åœ¨æ•°æ®åº“è¯¦æƒ…é¡µï¼Œç‚¹å‡» **Connect** â†’ **External**

2. å¤åˆ¶è¿æ¥ä¿¡æ¯

3. ä½¿ç”¨åœ¨çº¿å·¥å…· [ElephantSQL SQL Editor](https://www.elephantsql.com/docs/editor.html) è¿æ¥

---

## ç¬¬ä¸ƒæ­¥ï¼šå¯¼å…¥æœ¬åœ°æ•°æ®ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æœ¬åœ°æœ‰ `web_b2b.sql` æ–‡ä»¶ï¼Œéœ€è¦å¯¼å…¥åˆ° Render æ•°æ®åº“ï¼š

### 7.1 å‡†å¤‡ SQL æ–‡ä»¶

1. æ£€æŸ¥ `web_b2b.sql` æ–‡ä»¶æ˜¯å¦å­˜åœ¨

2. å¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼Œè€ƒè™‘å‹ç¼©

### 7.2 æ–¹æ³• Aï¼šä½¿ç”¨ pgAdminï¼ˆæ¨èï¼‰

1. ä¸‹è½½å®‰è£… [pgAdmin](https://www.pgadmin.org/)

2. è¿æ¥åˆ° Render æ•°æ®åº“ï¼š
   - ä½¿ç”¨ **External Database URL**
   - Host: `dpg-xxx.oregon-postgres.render.com`
   - Port: `5432`
   - Database: `web_b2b`
   - Username: `web_b2b_user`
   - Password: ä» URL ä¸­æå–

3. å³é”®ç‚¹å‡»æ•°æ®åº“ â†’ **Restore**

4. é€‰æ‹© `web_b2b.sql` æ–‡ä»¶

5. ç‚¹å‡» **Restore** æŒ‰é’®

### 7.3 æ–¹æ³• Bï¼šä½¿ç”¨å‘½ä»¤è¡Œï¼ˆé«˜çº§ï¼‰

1. å®‰è£… PostgreSQL å®¢æˆ·ç«¯å·¥å…·ï¼ˆWindows: ä½¿ç”¨ Git Bashï¼‰

2. è¿è¡Œå¯¼å…¥å‘½ä»¤ï¼š
   ```bash
   psql -h dpg-xxx.oregon-postgres.render.com -U web_b2b_user -d web_b2b < web_b2b.sql
   ```

3. è¾“å…¥å¯†ç 

**æ³¨æ„ï¼š**
- å¯¼å…¥å‰éœ€è¦ç¡®ä¿æ•°æ®åº“è¿ç§»å·²å®Œæˆ
- å¦‚æœæ•°æ®ä¸ Django æ¨¡å‹ä¸åŒ¹é…ï¼Œå¯èƒ½ä¼šæœ‰é”™è¯¯
- å»ºè®®å…ˆåœ¨æœ¬åœ°æµ‹è¯• SQL æ–‡ä»¶æ˜¯å¦å®Œæ•´

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### âŒ é—®é¢˜ 1ï¼šéƒ¨ç½²æ—¥å¿—æ˜¾ç¤º "could not connect to server"

**åŸå› ï¼š** æ•°æ®åº“ URL é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ `DATABASE_URL` ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ä½¿ç”¨çš„æ˜¯ **Internal Database URL**ï¼ˆä¸æ˜¯ Externalï¼‰
3. ç¡®è®¤ Region æ˜¯å¦ä¸åç«¯ç›¸åŒ
4. é‡æ–°ä¿å­˜ç¯å¢ƒå˜é‡ï¼Œè§¦å‘é‡æ–°éƒ¨ç½²

---

### âŒ é—®é¢˜ 2ï¼šè¿è¡Œ migrate æ—¶æç¤º "no such table"

**åŸå› ï¼š** æ•°æ®åº“è¿ç§»æ–‡ä»¶ç¼ºå¤±

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®è®¤æœ¬åœ°æœ‰è¿ç§»æ–‡ä»¶ï¼ˆåœ¨ `myapp/migrations/` ç›®å½•ï¼‰
2. ä½¿ç”¨ Shell è¿è¡Œï¼š
   ```bash
   cd server
   python manage.py makemigrations
   python manage.py migrate
   ```

---

### âŒ é—®é¢˜ 3ï¼šåå°ç™»å½•åçœ‹ä¸åˆ°æ•°æ®

**åŸå› ï¼š** æ•°æ®åº“æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰å¯¼å…¥æ•°æ®

**è§£å†³æ–¹æ³•ï¼š**
1. æ‰‹åŠ¨åœ¨åå°æ·»åŠ æ•°æ®
2. æˆ–è€…æŒ‰ç…§"ç¬¬ä¸ƒæ­¥"å¯¼å…¥ `web_b2b.sql`

---

### âŒ é—®é¢˜ 4ï¼šå¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦å¯¼è‡´è¿æ¥å¤±è´¥

**åŸå› ï¼š** URL ä¸­çš„å¯†ç éœ€è¦è½¬ä¹‰

**è§£å†³æ–¹æ³•ï¼š**
æ•°æ®åº“åˆ›å»ºåï¼Œå¯†ç æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œé€šå¸¸å·²ç»è½¬ä¹‰å¥½ã€‚ä¸éœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚

---

## âœ… éªŒè¯æ¸…å•

å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] æ•°æ®åº“åˆ›å»ºæˆåŠŸï¼ŒçŠ¶æ€ä¸º `Available`
- [ ] å¤åˆ¶äº† Internal Database URL
- [ ] åç«¯æœåŠ¡æ·»åŠ äº† `DATABASE_URL` ç¯å¢ƒå˜é‡
- [ ] åç«¯é‡æ–°éƒ¨ç½²æˆåŠŸ
- [ ] æ•°æ®åº“è¿ç§»å®Œæˆï¼ˆæ—¥å¿—ä¸­æœ‰ OKï¼‰
- [ ] åˆ›å»ºäº†è¶…çº§ç®¡ç†å‘˜è´¦å·
- [ ] å¯ä»¥ç™»å½•åå°ç®¡ç†é¡µé¢
- [ ] å¯ä»¥åœ¨åå°æ·»åŠ å’Œä¿å­˜æ•°æ®
- [ ] ï¼ˆå¯é€‰ï¼‰å¯¼å…¥äº†æœ¬åœ°æ•°æ®

---

## ğŸ“ æ•°æ®åº“è¿æ¥ä¿¡æ¯æ±‡æ€»

### ä¿å­˜ä»¥ä¸‹ä¿¡æ¯ï¼ˆå¤‡ç”¨ï¼‰

```
æ•°æ®åº“åç§°ï¼šweb_b2b
æ•°æ®åº“ç”¨æˆ·ï¼šweb_b2b_user
æ•°æ®åº“ä¸»æœºï¼šdpg-xxx.oregon-postgres.render.com
æ•°æ®åº“ç«¯å£ï¼š5432
Internal Database URLï¼špostgresql://web_b2b_user:xxx@dpg-xxx.oregon-postgres.render.com:5432/web_b2b
åå°ç®¡ç†è´¦å·ï¼šadmin / admin123ï¼ˆä½ è®¾ç½®çš„å¯†ç ï¼‰
åç«¯ URLï¼šhttps://django-backend-xxxxx.onrender.com/admin/
```

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„ Django åç«¯å·²ç»æˆåŠŸè¿æ¥åˆ° Render PostgreSQL æ•°æ®åº“ï¼

ä¸‹ä¸€æ­¥ï¼š
1. éƒ¨ç½² Next.js å‰ç«¯
2. é…ç½®å‰ç«¯è¿æ¥åç«¯ API
3. æµ‹è¯•å‰åç«¯è”è°ƒ

æœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶æŸ¥çœ‹ Render çš„å®˜æ–¹æ–‡æ¡£æˆ–è”ç³»æ”¯æŒï¼
