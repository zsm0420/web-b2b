# 数据库创建方案对比（替代 Render PostgreSQL）

## 📋 方案对比

| 方案 | 免费时长 | 优点 | 缺点 | 推荐度 |
|------|---------|------|------|--------|
| **Render PostgreSQL** | 30天 | 同平台管理，配置简单 | 只能用30天，之后要付费 | ⭐⭐⭐ |
| **Neon** | 永久免费 | 真正免费，自动休眠节省资源 | Serverless，有冷启动延迟 | ⭐⭐⭐⭐⭐ |
| **Supabase** | 永久免费 | 功能丰富，有管理界面 | 500MB 限制，连接数有限 | ⭐⭐⭐⭐ |
| **PlanetScale** | 永久免费 | MySQL 兼容，无改代码 | 需要改数据库配置 | ⭐⭐⭐⭐ |
| **Turso** | 永久免费 | 轻量级，边缘计算 | 不太适合 Django | ⭐⭐ |

---

## 🎯 推荐方案：Neon（永久免费）

### 为什么推荐 Neon？

✅ **真正的永久免费** - 不只是试用
✅ **Serverless 架构** - 按需使用，自动休眠
✅ **PostgreSQL 兼容** - 不需要改代码
✅ **配置简单** - 直接复制连接字符串即可
✅ **自动扩展** - 流量大时自动增加资源

---

## 📖 Neon 创建数据库详细教程

### 第一步：注册 Neon

1. 访问 [https://neon.tech](https://neon.tech)

2. 点击右上角 **Sign up** 按钮

3. 选择注册方式：
   - **Sign up with GitHub**（推荐）
   - 或者使用邮箱注册

4. 授权 Neon 访问 GitHub（如果选择 GitHub 登录）

5. 等待账号创建完成

### 第二步：创建数据库

1. 登录后，会自动进入 Dashboard

2. 点击 **Create a project** 按钮

3. 填写项目信息：

| 配置项 | 填写内容 |
|--------|---------|
| **Name** | `web-b2b` |
| **Region** | 选择离你最近的区域（例如：Singapore） |
| **PostgreSQL version** | `15`（默认） |

4. 点击 **Create project**

5. 等待创建完成（约 30 秒）

### 第三步：获取连接字符串

1. 创建成功后，会自动进入项目详情页

2. 在 **Connection Details** 部分，找到 **Connection string**

3. 复制 **Connection string**（注意是 Connection string，不是其他的）

格式类似：
```
postgres://web-b2b_owner:AbCdEf12345@ep-xxx.ap-southeast-1.aws.neon.tech/web-b2b?sslmode=require
```

**重要提示：**
- 保存这个字符串
- 不要泄露给他人
- 连接字符串包含密码

### 第四步：配置 Django 后端

#### 4.1 回到 Render 后端服务

1. 登录 [https://render.com](https://render.com)

2. 进入你的 Django 后端服务（例如 `django-backend`）

3. 点击 **Settings**

4. 找到 **Environment** 部分

5. 点击 **Environment Variables**

#### 4.2 添加 DATABASE_URL 环境变量

1. 点击 **+ Add Environment Variable**

2. 填写：

| Key | Value |
|-----|-------|
| `DATABASE_URL` | `你复制的 Neon Connection string` |

**示例：**
```
Key: DATABASE_URL
Value: postgres://web-b2b_owner:AbCdEf12345@ep-xxx.ap-southeast-1.aws.neon.tech/web-b2b?sslmode=require
```

3. 点击 **Save Changes**

4. 等待自动重新部署（2-3 分钟）

### 第五步：运行数据库迁移

#### 5.1 检查部署状态

1. 在服务详情页，查看最新部署状态

2. 确认状态为 `Live`

3. 点击查看部署日志

#### 5.2 运行迁移（如果需要）

如果 Build Command 没有自动运行迁移：

**方法 1：通过 Shell**

1. 点击 **Shell** 按钮

2. 运行：
   ```bash
   cd server
   python manage.py migrate
   ```

3. 看到 `OK` 表示成功

4. 输入 `exit` 退出

**方法 2：修改 Build Command**

1. 点击 **Settings**

2. 找到 **Build & Deploy**

3. 修改 **Build Command**：
   ```
   pip install -r server/requirements.txt && cd server && python manage.py migrate
   ```

4. 保存后自动重新部署

### 第六步：创建超级管理员

1. 点击 **Shell** 按钮

2. 运行：
   ```bash
   cd server
   python manage.py createsuperuser
   ```

3. 输入账号信息：
   ```
   Username: admin
   Email: admin@example.com
   Password: admin123
   Password (again): admin123
   ```

4. 退出 Shell

### 第七步：测试连接

1. 访问后台：
   ```
   https://django-backend-xxxxx.onrender.com/admin/
   ```

2. 使用 admin / admin123 登录

3. 如果成功登录，说明数据库连接正常！

---

## 💡 Neon 重要特性说明

### 自动休眠机制

- **无活动 5 分钟后**：数据库自动休眠
- **首次连接时**：会有 0.5-2 秒的冷启动延迟
- **不影响使用**：Django 会自动重连

### 免费额度

- 0.5 GB 存储
- 50 个连接数
- 每月 300 计算小时
- 足够小项目使用

### 付费升级

如果项目长大了，可以随时升级付费套餐：
- Starter: $19/月
- Scale: $99/月
- Enterprise: 定制

---

## 🔄 如果你想用 Supabase（备选方案）

### Supabase 注册

1. 访问 [https://supabase.com](https://supabase.com)

2. 点击 **Start your project**

3. 使用 GitHub 注册

4. 创建新项目：
   - Name: `web-b2b`
   - Database Password: 设置密码
   - Region: 选择区域

5. 等待创建（1-2 分钟）

### 获取连接字符串

1. 进入项目 Dashboard

2. 点击左侧 **Settings** → **Database**

3. 找到 **Connection string**

4. 选择 **URI** 标签

5. 复制连接字符串（格式类似 Neon）

### 配置步骤

与 Neon 相同：
1. 在 Render 后端添加 `DATABASE_URL` 环境变量
2. 运行迁移
3. 创建管理员
4. 测试连接

---

## ⚠️ 关于 Render PostgreSQL 的说明

### 如果你想用 Render PostgreSQL：

**前提条件：**
- 需要绑定信用卡
- 只能用 30 天
- 30 天后需要升级到付费套餐（$7/月起）

**创建方法：**
1. 登录 Render
2. 点击 **New +** → **Database**
3. 选择 **PostgreSQL**
4. 配置参数并创建

**重要提示：**
- 如果你看到没有数据库选项，可能是因为：
  1. 账号是新注册的，需要验证邮箱
  2. 需要绑定信用卡才能使用数据库
  3. Render 可能调整了免费策略

---

## ✅ 推荐操作顺序

### 方案 A：使用 Neon（推荐）

1. 注册 [https://neon.tech](https://neon.tech)
2. 创建数据库项目
3. 复制 Connection string
4. 在 Render 后端添加 `DATABASE_URL` 环境变量
5. 运行迁移
6. 创建管理员
7. 测试连接

### 方案 B：继续尝试 Render PostgreSQL

1. 确保邮箱已验证
2. 绑定信用卡（需要付费）
3. 创建 PostgreSQL 数据库
4. 复制 Internal Database URL
5. 配置环境变量
6. 运行迁移
7. 注意 30 天后需要付费

---

## 🎉 总结

**强烈推荐使用 Neon！**

原因：
- ✅ 真正的永久免费
- ✅ 配置简单，和 Render PostgreSQL 一样
- ✅ 不需要绑定信用卡
- ✅ 自动休眠，节省资源
- ✅ Django 完全兼容

如果 30 天后你想换回 Render PostgreSQL，只需要：
1. 创建 Render PostgreSQL 数据库
2. 在 Render 后端更新 `DATABASE_URL` 环境变量
3. 重新部署即可

---

有任何问题随时问我！
